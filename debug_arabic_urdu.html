<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic & Urdu Speech Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .arabic-text { direction: rtl; font-size: 18px; margin: 10px 0; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .primary { background: #007bff; color: white; }
        .success { background: #28a745; color: white; }
        .danger { background: #dc3545; color: white; }
        .warning { background: #ffc107; color: black; }
        .info { background: #17a2b8; color: white; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>ğŸ” Arabic & Urdu Speech Diagnostic Tool</h1>
    
    <div class="test-section">
        <h3>ğŸ“Š System Status</h3>
        <div id="system-status"></div>
        <button class="info" onclick="checkSystemStatus()">ğŸ”„ Refresh Status</button>
    </div>

    <div class="test-section">
        <h3>ğŸ‡¸ğŸ‡¦ Arabic Tests</h3>
        <div class="arabic-text">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
        <button class="primary" onclick="testArabicBasic()">1ï¸âƒ£ Basic Arabic Test</button>
        <button class="success" onclick="testArabicGoogle()">2ï¸âƒ£ Google TTS Test</button>
        <button class="warning" onclick="testArabicBrowser()">3ï¸âƒ£ Browser TTS Test</button>
        <div id="arabic-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ‡µğŸ‡° Urdu Tests</h3>
        <div class="arabic-text">Ø¢Ù¾ Ø¢Ø¬ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ</div>
        <button class="primary" onclick="testUrduBasic()">1ï¸âƒ£ Basic Urdu Test</button>
        <button class="success" onclick="testUrduGoogle()">2ï¸âƒ£ Google TTS Test</button>
        <button class="warning" onclick="testUrdHindi()">3ï¸âƒ£ Hindi Fallback Test</button>
        <div id="urdu-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ› ï¸ Manual TTS Tests</h3>
        <button class="info" onclick="testManualArabic()">ğŸ”Š Direct Arabic Audio</button>
        <button class="info" onclick="testManualUrdu()">ğŸ”Š Direct Urdu Audio</button>
        <button class="danger" onclick="stopAll()">ğŸ›‘ Stop All</button>
        <div id="manual-log" class="log"></div>
    </div>

    <!-- Load Voice Service -->
    <script src="config.js"></script>
    <script src="services/voiceService_new.js"></script>

    <script>
        let logCounter = 0;

        function log(message, elementId = 'system-status') {
            logCounter++;
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML += logMessage + '\n';
                element.scrollTop = element.scrollHeight;
            }
            
            console.log(logMessage);
        }

        function clearLog(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.innerHTML = '';
        }

        function checkSystemStatus() {
            clearLog('system-status');
            
            // Check Speech Synthesis
            if (window.speechSynthesis) {
                log('âœ… Speech Synthesis API available');
                const voices = window.speechSynthesis.getVoices();
                log(`ğŸ“Š Total voices: ${voices.length}`);
                
                const arabicVoices = voices.filter(v => v.lang.startsWith('ar'));
                const urduVoices = voices.filter(v => v.lang.startsWith('ur'));
                const hindiVoices = voices.filter(v => v.lang.startsWith('hi'));
                
                log(`ğŸ‡¸ğŸ‡¦ Arabic voices: ${arabicVoices.length}`);
                if (arabicVoices.length > 0) {
                    arabicVoices.forEach(v => log(`  - ${v.name} (${v.lang})`));
                }
                
                log(`ğŸ‡µğŸ‡° Urdu voices: ${urduVoices.length}`);
                if (urduVoices.length > 0) {
                    urduVoices.forEach(v => log(`  - ${v.name} (${v.lang})`));
                }
                
                log(`ğŸ‡®ğŸ‡³ Hindi voices: ${hindiVoices.length} (Urdu fallback)`);
                if (hindiVoices.length > 0) {
                    hindiVoices.forEach(v => log(`  - ${v.name} (${v.lang})`));
                }
            } else {
                log('âŒ Speech Synthesis API not available');
            }

            // Check ResponsiveVoice
            if (typeof responsiveVoice !== 'undefined') {
                if (responsiveVoice.voiceSupport && responsiveVoice.voiceSupport()) {
                    log('âœ… ResponsiveVoice available and supported');
                } else {
                    log('âš ï¸ ResponsiveVoice loaded but not supported');
                }
            } else {
                log('âŒ ResponsiveVoice not available');
            }

            // Check Voice Service
            if (typeof voiceService !== 'undefined') {
                log('âœ… Voice Service loaded');
            } else {
                log('âŒ Voice Service not loaded');
            }
        }

        function testArabicBasic() {
            clearLog('arabic-log');
            log('ğŸ§ª Testing Arabic with voice service...', 'arabic-log');
            
            const text = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ';
            
            if (typeof voiceService !== 'undefined') {
                const detected = voiceService.detectLanguage(text);
                log(`ğŸŒ Detected language: ${detected}`, 'arabic-log');
                
                voiceService.speak(text, detected)
                    .then(() => {
                        log('âœ… Arabic speech completed', 'arabic-log');
                    })
                    .catch(error => {
                        log(`âŒ Arabic speech failed: ${error}`, 'arabic-log');
                    });
            } else {
                log('âŒ Voice service not available', 'arabic-log');
            }
        }

        function testArabicGoogle() {
            clearLog('arabic-log');
            log('ğŸŒ Testing Google TTS for Arabic...', 'arabic-log');
            
            const text = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ';
            
            try {
                const audio = document.createElement('audio');
                const encodedText = encodeURIComponent(text);
                const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=ar&client=tw-ob`;
                
                log(`ğŸ”— Google TTS URL: ${url}`, 'arabic-log');
                
                audio.src = url;
                audio.style.display = 'none';
                document.body.appendChild(audio);
                
                audio.onloadeddata = () => {
                    log('âœ… Google TTS audio loaded', 'arabic-log');
                    audio.play().then(() => {
                        log('ğŸ”Š Google TTS playing...', 'arabic-log');
                    }).catch(error => {
                        log(`âŒ Google TTS play failed: ${error}`, 'arabic-log');
                    });
                };
                
                audio.onended = () => {
                    log('âœ… Google TTS completed', 'arabic-log');
                    audio.remove();
                };
                
                audio.onerror = (error) => {
                    log(`âŒ Google TTS error: ${error}`, 'arabic-log');
                    audio.remove();
                };
                
            } catch (error) {
                log(`âŒ Google TTS failed: ${error}`, 'arabic-log');
            }
        }

        function testArabicBrowser() {
            clearLog('arabic-log');
            log('ğŸ–¥ï¸ Testing browser TTS for Arabic...', 'arabic-log');
            
            const text = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ';
            
            if (window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();
                const arabicVoices = voices.filter(v => v.lang.startsWith('ar'));
                
                if (arabicVoices.length > 0) {
                    utterance.voice = arabicVoices[0];
                    log(`ğŸ¤ Using Arabic voice: ${arabicVoices[0].name}`, 'arabic-log');
                } else {
                    log('âš ï¸ No Arabic voices, using default', 'arabic-log');
                }
                
                utterance.lang = 'ar-SA';
                utterance.rate = 0.9;
                
                utterance.onstart = () => log('ğŸ”Š Browser TTS started', 'arabic-log');
                utterance.onend = () => log('âœ… Browser TTS completed', 'arabic-log');
                utterance.onerror = (error) => log(`âŒ Browser TTS error: ${error.error}`, 'arabic-log');
                
                window.speechSynthesis.speak(utterance);
            } else {
                log('âŒ Browser TTS not available', 'arabic-log');
            }
        }

        function testUrduBasic() {
            clearLog('urdu-log');
            log('ğŸ§ª Testing Urdu with voice service...', 'urdu-log');
            
            const text = 'Ø¢Ù¾ Ø¢Ø¬ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ';
            
            if (typeof voiceService !== 'undefined') {
                const detected = voiceService.detectLanguage(text);
                log(`ğŸŒ Detected language: ${detected}`, 'urdu-log');
                
                voiceService.speak(text, detected)
                    .then(() => {
                        log('âœ… Urdu speech completed', 'urdu-log');
                    })
                    .catch(error => {
                        log(`âŒ Urdu speech failed: ${error}`, 'urdu-log');
                    });
            } else {
                log('âŒ Voice service not available', 'urdu-log');
            }
        }

        function testUrduGoogle() {
            clearLog('urdu-log');
            log('ğŸŒ Testing Google TTS for Urdu (via Hindi)...', 'urdu-log');
            
            const text = 'Ø¢Ù¾ Ø¢Ø¬ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ';
            
            try {
                const audio = document.createElement('audio');
                const encodedText = encodeURIComponent(text);
                const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=hi&client=tw-ob`;
                
                log(`ğŸ”— Google TTS URL (Hindi): ${url}`, 'urdu-log');
                
                audio.src = url;
                audio.style.display = 'none';
                document.body.appendChild(audio);
                
                audio.onloadeddata = () => {
                    log('âœ… Google TTS audio loaded', 'urdu-log');
                    audio.play().then(() => {
                        log('ğŸ”Š Google TTS playing...', 'urdu-log');
                    }).catch(error => {
                        log(`âŒ Google TTS play failed: ${error}`, 'urdu-log');
                    });
                };
                
                audio.onended = () => {
                    log('âœ… Google TTS completed', 'urdu-log');
                    audio.remove();
                };
                
                audio.onerror = (error) => {
                    log(`âŒ Google TTS error: ${error}`, 'urdu-log');
                    audio.remove();
                };
                
            } catch (error) {
                log(`âŒ Google TTS failed: ${error}`, 'urdu-log');
            }
        }

        function testUrdHindi() {
            clearLog('urdu-log');
            log('ğŸ‡®ğŸ‡³ Testing Hindi TTS for Urdu...', 'urdu-log');
            
            const text = 'Ø¢Ù¾ Ø¢Ø¬ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ';
            
            if (window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();
                const hindiVoices = voices.filter(v => v.lang.startsWith('hi'));
                
                if (hindiVoices.length > 0) {
                    utterance.voice = hindiVoices[0];
                    log(`ğŸ¤ Using Hindi voice: ${hindiVoices[0].name}`, 'urdu-log');
                } else {
                    log('âš ï¸ No Hindi voices, using default', 'urdu-log');
                }
                
                utterance.lang = 'hi-IN';
                utterance.rate = 0.9;
                
                utterance.onstart = () => log('ğŸ”Š Hindi TTS started', 'urdu-log');
                utterance.onend = () => log('âœ… Hindi TTS completed', 'urdu-log');
                utterance.onerror = (error) => log(`âŒ Hindi TTS error: ${error.error}`, 'urdu-log');
                
                window.speechSynthesis.speak(utterance);
            } else {
                log('âŒ Browser TTS not available', 'urdu-log');
            }
        }

        function testManualArabic() {
            clearLog('manual-log');
            log('ğŸ”Š Manual Arabic TTS test...', 'manual-log');
            
            // Simple direct approach
            if (window.speechSynthesis) {
                const text = 'Hello, this is Arabic text: Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ';
                const utterance = new SpeechSynthesisUtterance(text);
                
                utterance.onstart = () => log('ğŸ”Š Manual TTS started', 'manual-log');
                utterance.onend = () => log('âœ… Manual TTS completed', 'manual-log');
                utterance.onerror = (error) => log(`âŒ Manual TTS error: ${error.error}`, 'manual-log');
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function testManualUrdu() {
            clearLog('manual-log');
            log('ğŸ”Š Manual Urdu TTS test...', 'manual-log');
            
            // Simple direct approach
            if (window.speechSynthesis) {
                const text = 'Hello, this is Urdu text: Ø¢Ù¾ Ø¢Ø¬ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ';
                const utterance = new SpeechSynthesisUtterance(text);
                
                utterance.onstart = () => log('ğŸ”Š Manual TTS started', 'manual-log');
                utterance.onend = () => log('âœ… Manual TTS completed', 'manual-log');
                utterance.onerror = (error) => log(`âŒ Manual TTS error: ${error.error}`, 'manual-log');
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function stopAll() {
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
            
            if (typeof voiceService !== 'undefined') {
                voiceService.stopAll();
            }
            
            // Remove all audio elements
            document.querySelectorAll('audio').forEach(audio => audio.remove());
            
            log('ğŸ›‘ All audio stopped', 'manual-log');
        }

        // Initialize on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkSystemStatus();
            }, 1000);
        });

        // Also check when voices change
        if (window.speechSynthesis) {
            window.speechSynthesis.onvoiceschanged = () => {
                log('ğŸ”„ Voices changed, refreshing status...');
                setTimeout(checkSystemStatus, 500);
            };
        }
    </script>
</body>
</html> 